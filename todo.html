<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Todo App</title>
    </head>
    <body>
        <input id='input' type='text'/>
        <input id='date' type='date'/>
        <button onclick="addTodo()">Click Me!</button>

        <div id="todo-list"></div>
        <script>
            // Model
            let todos
            const savedTodos = JSON.parse(localStorage.getItem('todos'))
            console.log(savedTodos)
            if(Array.isArray(savedTodos)) {
                todos = savedTodos
            } else {
                todos = [{
                    title: "Get groceries",
                    dueDate: '2021-10-04',
                    id: 'id1'
                }, {
                    title: "Wash car",
                    dueDate: '2021-02-03',
                    id: 'id2'
                }, {
                    title: "Make dinner",
                    dueDate: '2021-03-04',
                    id: 'id3'
                }]
            }

            render()

            function createTodo(todoText, date) {
                const id = '' + new Date().getTime()
                console.log(id)

                todos.push({
                    title: todoText,
                    dueDate: date,
                    id: id
                })

                saveTodos()
            }

            function removeTodo(idToDelete) {
                todos = todos.filter(function(todo) {
                    return todo.id !== idToDelete
                })

                saveTodos()
            }

            function saveTodos() {
                localStorage.setItem('todos', JSON.stringify(todos))
            }


            // Controller
            function addTodo() {
                const input = document.getElementById('input')
                const todoText = input.value
                const dateInput = document.getElementById('date')
                const date = dateInput.value

                createTodo(todoText, date)

                render()
            }

            function deleteTodo(e) {
                const deleteButton = e.target
                const idToDelete = deleteButton.id

                removeTodo(idToDelete)
                render()
            }

            //View
            function render() {
                // reset our list
                document.getElementById('todo-list').innerHTML = ''

                todos.forEach(function(todo) {
                    const divEl = document.createElement('div')
                    divEl.innerText = `${todo.title} | ${todo.dueDate}`

                    const deleteButton = document.createElement('button')
                    deleteButton.innerText = "Delete"
                    deleteButton.style= 'margin-left: 12px'
                    deleteButton.onclick= deleteTodo
                    deleteButton.id = todo.id
                    divEl.appendChild(deleteButton)

                    const todoList = document.getElementById('todo-list')
                    todoList.appendChild(divEl)
                })
            }
        </script>
    </body>
</html>
